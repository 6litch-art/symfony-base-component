<?xml version="1.0" encoding="UTF-8" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
    <services>

        <defaults public="false" />

        <!--

            Base features

            -->
        <service id="Base\Form\FormProxyInterface" alias="Base\Form\FormProxy"/>
        <service id="Base\Form\FormProxy" public="true" />

        <service id="Base\Form\FormFactoryInterface" alias="Base\Form\FormFactory"/>
        <service id="Base\Form\FormFactory" public="true">
            <argument type="service" id="doctrine.orm.entity_manager" />
        </service>

        <service id="Base\Twig\FormTwigExtension" >
            <tag name="twig.extension" />
            <argument type="service" id="base.form.proxy" />
       </service>

        <service id="Base\Command\MappingCommand">
            <tag name="console.command" />
        </service>
        <service id="Base\Command\StatusCommand">
            <tag name="console.command" />
        </service>

        <service id="Base\Controller\BaseController">
            <tag name="controller.service_arguments" />
            <call method="setContainer"><argument type="service" id="service_container" /></call>
            <argument type="service" id="base.service" />
        </service>

        <service id="Base\Subscriber\BaseSubscriber">
            <tag name="kernel.event_subscriber" />            
            <argument type="service" id="base.service" />
        </service>

        <service id="Base\Service\BaseService" public="true">
            <tag name="twig.runtime" />
            <argument type="service" id="kernel" />
            <argument type="service" id="twig" />
            <argument type="service" id="doctrine.orm.entity_manager" />
            <argument type="service" id="base.form.factory" />
            <argument type="service" id="notifier" />
            <argument type="service" id="notifier.channel_policy" />
            <argument type="service" id="slugger" />
            <argument type="service" id="security.authorization_checker" />
            <argument type="service" id="security.token_storage" />
            <argument type="service" id="security.csrf.token_manager" />
        </service>

        <service id="Base\Twig\BaseTwigExtension" >
            <tag name="twig.extension" />
            <argument type="service" id="translator" />
       </service>

        <!--

            Commands

        -->

        <service id="Base\Command\ThreadPublishableCommand">
            <tag name="console.command" />
            <argument type="service" id="doctrine.orm.entity_manager" />
        </service>

        <!--

            Controllers

        -->
        <service id="Base\Controller\ExceptionController">
            <tag name="controller.service_arguments" />
            <call method="setContainer"><argument type="service" id="service_container" /></call>
            <argument type="service" id="base.service" />
        </service>
        <service id="Base\Controller\SecurityController">
            <tag name="controller.service_arguments" />
            <call method="setContainer"><argument type="service" id="service_container" /></call>
            <argument type="service" id="base.service" />
            <argument type="service" id="App\Repository\UserRepository" />
            <argument type="service" id="App\Repository\User\TokenRepository" />
        </service>
        <service id="Base\Controller\MaintenanceController">
            <tag name="controller.service_arguments" />
            <call method="setContainer"><argument type="service" id="service_container" /></call>
            <argument type="service" id="base.service" />
        </service>

        <!--

            Type declaration

            -->
        <service id="Base\Form\AbstractType" />

        <service id="Base\Form\FormProcessor">
            <argument type="service" id="base.form.factory" />
            <argument type="service" id="security.csrf.token_manager" />
            <argument type="service" id="request_stack" />
        </service>

        <!--

            Subscriber

            -->
        <service id="Base\Subscriber\LocaleSubscriber">
            <tag name="kernel.event_subscriber" />
            <argument type="service" id="security.helper" />
            <argument type="service" id="base.service" />
        </service>

        <service id="Base\Subscriber\MaintenanceSubscriber">
            <tag name="kernel.event_subscriber" />
            <argument type="service" id="base.service" />
        </service>

        <service id="Base\Subscriber\TimezoneSubscriber">
            <tag name="kernel.event_subscriber" />
        </service>

        <service id="Base\DatabaseSubscriber\ConnectionSubscriber">
            <tag name="kernel.event_subscriber" />
        </service>

        <service id="Base\DatabaseSubscriber\AnnotationSubscriber">
            <tag name="doctrine.event_subscriber" />
            <argument type="service" id="doctrine.orm.entity_manager" />
        </service>

        <service id="Base\EntitySubscriber\ThreadSubscriber">
            <tag name="doctrine.event_subscriber" />
            <argument type="service" id="event_dispatcher" />
        </service>

        <service id="Base\Service\SpamChecker" public="true">
            <argument type="service" id="http_client" />
            <bind key="$akismetKey">%env(AKISMET_KEY)%</bind>
        </service>

        <service id="Base\Service\FileUploader" public="true">
            <bind key="$uploadDir">%base.upload_dir%</bind>
        </service>

        <service id="Base\Twig\ClassTwigExtension" >
            <tag name="twig.extension" />
       </service>

        <!--

            DOCTRINE

        -->
        <service id="Base\Database\NamingStrategy"  public="true" />
        <service id="Base\Database\Factory\ConnectionFactory"  public="true"/>
        <service id="Base\Database\Factory\ClassMetadataFactory"  public="true"/>

        <service id="Base\DatabaseSubscriber\ConnectionSubscriber">
            <tag name="kernel.event_subscriber" />
        </service>

        <service id="Base\DatabaseSubscriber\AnnotationSubscriber">
            <tag name="doctrine.event_subscriber" />
            <argument type="service" id="doctrine.orm.entity_manager" />
            <argument type="service" id="base.database.annotation_reader" />
        </service>

        <service id="Base\Database\AnnotationReader" public="true">
            <argument type="service" id="parameter_bag" />
            <argument type="service" id="doctrine.orm.entity_manager" />
            <argument type="service" id="cache.app" />
        </service>

        <!--

            Twig declarations

            -->

        <service id="Base\Twig\Loader\FilesystemLoader">
            <tag name="twig.loader" />
            <argument type="service" id="base.service" />
            <argument type="service" id="twig" />
        </service>


        <!--

            Validation constraints

            -->
        <service id="Base\Validator\Constraints\UniqueEntityValidator">
            <tag name="validator.constraint_validator" />
            <argument type="service" id="doctrine" />
        </service>
        <service id="Base\Validator\Constraints\StringCaseEntityValidator">
            <tag name="validator.constraint_validator" />
            <argument type="service" id="doctrine" />
        </service>

        <!--

            Notifier

        -->
        <service id="Base\Notifier\Channel\BrowserPlusChannel">
            <tag name="notifier.channel" channel="browser+" />
            <argument type="service" id="request_stack" />
        </service>
        <service id="Base\Notifier\Channel\EmailPlusChannel">
            <tag name="notifier.channel" channel="email+" />
            <argument type="service" id="mailer.default_transport" />
        </service>

        <!--

            USER SECTION

        -->

        <service id="Base\Controller\Client\Thread\SearchController">
            <tag name="controller.service_arguments" />
            <call method="setContainer"><argument type="service" id="service_container" /></call>
            <argument type="service" id="base.service" />
            <argument type="service" id="App\Repository\ThreadRepository" />
        </service>

        <service id="Base\Controller\Client\User\SearchController">
            <tag name="controller.service_arguments" />
            <call method="setContainer"><argument type="service" id="service_container" /></call>
            <argument type="service" id="base.service" />
            <argument type="service" id="App\Repository\UserRepository" />
        </service>

        <service id="Base\Controller\Client\User\ProfileController">
            <tag name="controller.service_arguments" />
            <call method="setContainer"><argument type="service" id="service_container" /></call>
            <argument type="service" id="App\Repository\UserRepository" />
        </service>

        <service id="Base\Controller\Client\User\SettingsController">
            <tag name="controller.service_arguments" />
            <call method="setContainer"><argument type="service" id="service_container" /></call>
            <argument type="service" id="base.service" />
            <argument type="service" id="App\Repository\UserRepository" />
            <argument type="service" id="scheb_two_factor.qr_code_generator" />
        </service>

        <service id="Base\Security\UserChecker"           >
            <argument type="service" id="base.service" />
        </service>
        
        <service id="Base\Security\UserProvider"           />
        <service id="Base\Security\LoginFormAuthenticator">
            <argument type="service" id="doctrine.orm.entity_manager" />
            <argument type="service" id="router.default" />
            <argument type="service" id="security.csrf.token_manager" />
        </service>

        <!-- Listener declarations -->
        <service id="Base\Subscriber\SecuritySubscriber">
            <tag name="kernel.event_subscriber" />
            <argument type="service" id="security.helper" />
            <argument type="service" id="event_dispatcher" />
            <argument type="service" id="translator" />
            <argument type="service" id="App\Repository\User\NotificationRepository" />
            <argument type="service" id="base.service" />
        </service>

        <service id="Base\EntitySubscriber\UserSubscriber">
            <tag name="doctrine.event_subscriber" />
            <argument type="service" id="base.service" />
            <argument type="service" id="security.token_storage" />
            <argument type="service" id="event_dispatcher" />
        </service>

        <service id="Base\Field\Type\SelectType">
            <tag name="form.type" />
            <argument type="service" id="base.service" />
        </service>

        <service id="Base\Field\Type\QuillType">
            <tag name="form.type" />
            <argument type="service" id="base.service" />
        </service>

        <service id="Base\Field\Type\DateTimePickerType">
            <tag name="form.type" />
            <argument type="service" id="base.service" />
        </service>

        <service id="Base\Field\Type\RelationType">
            <tag name="form.type" />
            <argument type="service" id="doctrine" />
        </service>

        <service id="Base\Field\Type\FontAwesomeType">
            <tag name="form.type" />
            <argument type="service" id="base.service" />
        </service>

        <service id="Base\Field\Type\ColorType">
            <tag name="form.type" />
            <argument type="service" id="base.service" />
        </service>

        <service id="Base\Field\Type\SlugType">
            <tag name="form.type" />
            <argument type="service" id="base.service" />
        </service>

        <service id="Base\Field\Configurator\DateTimePickerConfigurator">
            <tag name="ea.field_configurator" />
        </service>

        <service id="Base\Field\Configurator\SlugConfigurator">
            <tag name="ea.field_configurator" />
            <argument type="service" id="translator" />
        </service>

        <service id="Base\Field\Configurator\FontAwesomeConfigurator">
            <tag name="ea.field_configurator" />
        </service>

        <service id="Base\Field\Configurator\BooleanConfigurator">
            <tag name="ea.field_configurator" />
            <argument type="service" id="EasyCorp\Bundle\EasyAdminBundle\Router\AdminUrlGenerator" />
        </service>

        <service id="Base\Field\Configurator\SelectConfigurator">
            <tag name="ea.field_configurator" />
        </service>

        <service id="Base\Field\Configurator\FileConfigurator">
            <tag name="ea.field_configurator" />
        </service>

        <service id="Base\Field\Configurator\CountryConfigurator">
            <tag name="ea.field_configurator" />
            <argument type="service" id="assets.packages" />
            <argument type="service" id="translator" />
        </service>
        <service id="Base\Field\Configurator\GenderConfigurator">
            <tag name="ea.field_configurator" />
            <argument type="service" id="assets.packages" />
        </service>
        <service id="Base\Field\Configurator\RoleConfigurator">
            <tag name="ea.field_configurator" />
        </service>
        <service id="Base\Field\Configurator\StateConfigurator">
            <tag name="ea.field_configurator" />
        </service>
        <service id="Base\Field\Configurator\RelationConfigurator">
            <tag name="ea.field_configurator" />
            <argument type="service" id="EasyCorp\Bundle\EasyAdminBundle\Factory\EntityFactory" />
            <argument type="service" id="EasyCorp\Bundle\EasyAdminBundle\Router\AdminUrlGenerator" />
            <argument type="service" id="translator" />
        </service>
<!--        <service id="Base\Field\Configurator\DropzoneConfigurator">
            <tag name="ea.field_configurator" />
            <argument type="service" id="EasyCorp\Bundle\EasyAdminBundle\Factory\EntityFactory" />
            <argument type="service" id="EasyCorp\Bundle\EasyAdminBundle\Router\AdminUrlGenerator" />
            <argument type="service" id="translator" />
        </service>-->

        <service id="Base\Controller\Dashboard\DashboardController">
            <tag name="controller.service_arguments" />
            <call method="setContainer">
                <argument type="service" id="service_container" />
            </call>
            <argument type="service" id="EasyCorp\Bundle\EasyAdminBundle\Router\AdminUrlGenerator" />
            <argument type="service" id="EasyCorp\Bundle\EasyAdminBundle\Provider\AdminContextProvider" />
            <argument type="service" id="base.service" />
            <argument type="service" id="security.authentication_utils" />
            <argument type="service" id="ga.service" on-invalid="null" />
        </service>

        <service id="Base\Subscriber\DashboardSubscriber">
            <tag name="kernel.event_subscriber" />
            <argument type="service" id="base.service" />
            <argument type="service" id="EasyCorp\Bundle\EasyAdminBundle\Router\AdminUrlGenerator" />
            <argument type="service" id="EasyCorp\Bundle\EasyAdminBundle\Provider\AdminContextProvider" />
        </service>

        <service id="Base\Controller\Dashboard\Crud\User\UserCrudController">
            <tag name="ea.crud_controller" />
            <tag name="controller.service_arguments" />
            <call method="setContainer">
                <argument type="service" id="service_container" />
            </call>
        </service>
        <service id="Base\Controller\Dashboard\Crud\User\GroupCrudController">
            <tag name="ea.crud_controller" />
            <tag name="controller.service_arguments" />
            <call method="setContainer">
                <argument type="service" id="service_container" />
            </call>
        </service>
        <service id="Base\Controller\Dashboard\Crud\User\LogCrudController">
            <tag name="ea.crud_controller" />
            <tag name="controller.service_arguments" />
            <call method="setContainer">
                <argument type="service" id="service_container" />
            </call>
        </service>
        <service id="Base\Controller\Dashboard\Crud\User\TokenCrudController">
            <tag name="ea.crud_controller" />
            <tag name="controller.service_arguments" />
            <call method="setContainer">
                <argument type="service" id="service_container" />
            </call>
        </service>
        <service id="Base\Controller\Dashboard\Crud\User\NotificationCrudController">
            <tag name="ea.crud_controller" />
            <tag name="controller.service_arguments" />
            <call method="setContainer">
                <argument type="service" id="service_container" />
            </call>
        </service>
        <service id="Base\Controller\Dashboard\Crud\User\PermissionCrudController">
            <tag name="ea.crud_controller" />
            <tag name="controller.service_arguments" />
            <call method="setContainer">
                <argument type="service" id="service_container" />
            </call>
        </service>
        <service id="Base\Controller\Dashboard\Crud\User\PenaltyCrudController">
            <tag name="ea.crud_controller" />
            <tag name="controller.service_arguments" />
            <call method="setContainer">
                <argument type="service" id="service_container" />
            </call>
        </service>
    </services>
</container>
